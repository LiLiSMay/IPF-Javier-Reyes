<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Jump Game</title>
    <style>
        :root {
            --bg-color: #87CEEB;
            --accent: #D2691E;
            --gold: #FFD700;
            --box-brown-dark: #654321;
            --box-brown-light-start: #CD853F;
            --box-brown-light-end: #8B4513;
            --font-family: Arial, sans-serif;

            /* Responsive sizes (use clamp to keep values reasonable on very small/large screens) */
            /* default Mario sprite size (waiting) reduced further to avoid covering UI */
            --mario-w: clamp(40px, 7.5vw, 80px);
            --mario-h: clamp(56px, 9.5vw, 110px);
            --block-size: clamp(48px, 8vw, 88px);
            --jump-btn-w: clamp(88px, 18vw, 160px);
            --jump-btn-h: clamp(48px, 10vw, 80px);
            --logo-w: clamp(140px, 40vw, 340px);
            --ground-offset: clamp(80px, 12vh, 140px);
            /* increased minimum distance from bottom for better mobile compatibility */
            --jump-height: clamp(80px, 18vh, 160px);
            /* how high Mario jumps visually */
            --modal-size: clamp(280px, 44vw, 420px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            overflow: hidden;
            background: var(--bg-color);
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-image: url('img/FondoOrignal.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        #backgroundImage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            z-index: 0;
        }

        .jump-button {
            position: fixed;
            bottom: max(12px, 2vh);
            left: 50%;
            transform: translateX(-50%);
            width: var(--jump-btn-w);
            height: var(--jump-btn-h);
            background-image: url('img/icono.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            border: none;
            cursor: pointer;
            transition: transform 0.12s;
            z-index: 5;
            -webkit-appearance: none;
            appearance: none;
            background-color: transparent;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .jump-button:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .jump-button:active {
            transform: translateX(-50%) scale(0.95);
        }

        .jump-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(210, 105, 30, 0.15);
        }

        .message {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.98);
            border: 4px solid var(--gold);
            border-radius: 12px;
            width: var(--modal-size);
            height: var(--modal-size);
            padding: 0;
            /* inner padding handled in .message-body */
            overflow: hidden;
            /* prevent modal from changing size; inner scroll will handle content */
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.35);
            z-index: 12;
            opacity: 0;
            animation: showMessage 0.22s ease-in-out forwards;
            font-size: clamp(13px, 2.2vw, 16px);
            line-height: 1.6;
            pointer-events: auto;
        }

        /* Scrollable area inside the square modal */
        .message .message-body {
            padding: clamp(12px, 3.2vw, 22px) clamp(14px, 4.5vw, 28px);
            height: calc(var(--modal-size) - 56px);
            /* reserve space for header/close if needed */
            overflow-y: auto;
        }

        .message h3 {
            margin: 0 0 10px 0;
        }

        /* Jump animation uses transform (translateY) so layout doesn't shift and centering is preserved */
        @keyframes jump {
            0% {
                transform: translateX(-50%) translateY(0);
            }

            40% {
                transform: translateX(-50%) translateY(calc(-1 * var(--jump-height)));
            }

            60% {
                transform: translateX(-50%) translateY(calc(-1 * var(--jump-height)));
            }

            100% {
                transform: translateX(-50%) translateY(0);
            }
        }

        .block {
            position: absolute;
            top: 65vh;
            left: 50%;
            transform: translateX(-50%);
            width: var(--block-size);
            height: var(--block-size);
            background: url('img/bloque.png') no-repeat center center / contain;
            z-index: 4;
            pointer-events: none;
        }

        .block.hit {
            filter: brightness(0.7);
        }

        #mario {
            position: fixed;
            bottom: calc(max(12px, 2vh) + var(--jump-btn-h) + 2px);
            left: 50%;
            transform: translateX(-50%);
            width: var(--mario-w);
            height: var(--mario-h);
            background-image: url('img/Mario-Espera-Photoroom.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            transition: transform 0.35s ease-out;
            /* transform-only to keep things smooth */
            z-index: 10;
            display: block;
            will-change: transform;
        }

        /* Apply jump by adding class; animation alters translateY but keeps translateX(-50%) for centering */
        #mario.jumping {
            animation: jump 0.8s ease-in-out;
            background-image: url('img/Mario-Salta-Photoroom.png');
            display: block;
        }

        /* Small adjustments remain possible via media queries but most sizing uses clamp() vars above */
        @media (max-width: 420px) {
            .message {
                width: calc(100% - 32px);
                left: 50%;
                transform: translateX(-50%);
                padding: 10px 12px;
                font-size: clamp(12px, 2.6vw, 14px);
                max-height: 72vh;
            }

            /* Mobile adjustments for consistent spacing */
            #mario {
                bottom: calc(max(16px, 3vh) + var(--jump-btn-h) + 2px);
                z-index: 10;
            }

            .jump-button {
                width: var(--jump-btn-w);
                height: var(--jump-btn-h);
                bottom: max(16px, 3vh);
                z-index: 5;
            }
        }

        @keyframes showMessage {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent);
            color: white;
            border: none;
            width: clamp(28px, 4vw, 44px);
            height: clamp(28px, 4vw, 44px);
            border-radius: 50%;
            font-size: clamp(16px, 2.6vw, 22px);
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            pointer-events: auto;
        }

        .close-btn:hover {
            background: #A0522D;
            transform: scale(1.1);
        }

        .message h3 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 18px;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 8px;
        }

        .message ul {
            list-style: none;
            padding-left: 0;
            margin-top: 8px;
        }

        .message li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
            color: #333;
        }

        .message li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: bold;
        }

        .logo-container {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(240, 221, 9, 0.98);
            border: 4px solid var(--gold);
            border-radius: 50%;
            padding: 8px;
            z-index: 3;
            width: calc(var(--logo-w) + 20px);
            height: calc(var(--logo-w) + 20px);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-container img {
            width: var(--logo-w);
            height: auto;
            display: block;
            margin: 0 auto;
            pointer-events: none;
        }

        .social-links {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 15;
        }

        .social-link {
            width: clamp(44px, 8vw, 56px);
            height: clamp(44px, 8vw, 56px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .social-link:hover {
            transform: scale(1.1);
        }

        .social-link img {
            width: 60%;
            height: 60%;
            object-fit: contain;
        }

        .whatsapp-link {
            background: #25D366;
            ;
        }

        .telegram-link {
            background: #0088cc;
        }

        @media (max-width: 420px) {
            .social-links {
                right: 10px;
                bottom: 15px;
            }
        }
    </style>
</head>

<body>
    <div id="gameContainer">
        <div class="logo-container">
            <img src="img/Sigla.png" alt="Logo">
        </div>

        <div class="social-links">
            <a href="https://chat.whatsapp.com/HJxC8RhlBuB1DezavtFWUq?mode=wwt" target="_blank"
                class="social-link whatsapp-link" aria-label="Contactar por WhatsApp">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/WhatsApp.svg/1200px-WhatsApp.svg.png"
                    alt="WhatsApp">
            </a>
            <a href="https://t.me/+Y56rqrnfJAdiNzYx" target="_blank" class="social-link telegram-link"
                aria-label="Contactar por Telegram">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/2048px-Telegram_logo.svg.png"
                    alt="Telegram">
            </a>
        </div>

        <div class="block" id="block"></div>

        <div id="mario"></div>

        <button class="jump-button" id="jumpBtn"></button>
    </div>

    <script type="module">
        const messages = [
            {
                title: "1. Lucha Contra la Corrupción",
                content: [
                    "Tráfico de influencia de contra autoridades tan a familiares sin examen de competencia. Complicidad de decano y director de carrera.",
                    "La obstaculización de decanatura a todos los trámites mediante objeciones sistemáticas.",
                    "Rectorado y decanato llevaron el proyecto Key Lab convenio con Corea del Sur para IA a la Facultad de ingeniería ya la Técnica"
                ]
            },
            {
                title: "2. Fortalecer la Institución: Académico",
                content: [
                    "Continuidad de los 7 nuevos planes ya implementadas",
                    "Apoyar a docentes y estudiantes en material académico",
                    "Mejorar los cursos de temporada en consenso con docentes y estudiantes",
                    "Evaluar y acreditar nuestros programas académicos, y actualizar los planes",
                    "Impulsar el Plan Estratégico de la Carrera PEI"
                ]
            },
            {
                title: "3. Fortalecer la Institución: Tecnológico",
                content: [
                    "Mejoramiento de la red inalámbrica, mas Internet para Informática",
                    "Mejoramiento de laboratorios para uso de estudiantes",
                    "Mejorar acceso uso de tecnologías en Data Center para aplicaciones CLOUD, y la Carrera pueda contar con su propia Nube de Informática",
                    "Potenciar recursos para IA",
                    "Fortalecer la Radio OPEN Informática, para los estudiantes, y puedan mostrar sus productos en extensión universitaria"
                ]
            },
            {
                title: "4. Económico: Recuperar los recursos del Pre facultativo",
                content: [
                    "Continuar la lucha y recuperar los recursos del Pre facultativo en su mayoría generados por postulantes a informática",
                    "La decanatura se queda con el 100% de los recursos generados en cursos pre universitarios.",
                    "Se calcula que el pre universitario o pre facultativo genera mas de 2 millones de bolivianos por gestión, los cuales se estarían gastando desde decanatura en complicidad con rectorado en preparación de la campaña rectoral del 2027",
                    "Las contrataciones que haría decanato serían de personal político dirigido a campañas políticas.",
                    "Transparentaremos el uso de esos recursos."
                ]
            },
            {
                title: "5. Posgrado y Facultización",
                content: [
                    "Continuar la lucha histórica por la facultización de Informática, somos la segunda carrera mas grande de la UMSA",
                    "Continuar la lucha por nuestra institución pese a las adversidades y contra el decano de turno.",
                    "El uso arbitrario de los recursos de posgrado de informática, el decano uso mas de Bs. 100.000.- el 2024 para gastos de decanatura.",
                    "Nunca olvidaremos que el 2013 con la Licenciada Elizabeth Garcia había 1,300,000.- para compra de un edificio de posgrado, dinero que desapareció en área desconcentrada de decanato. Memoriam a la Querida Colega."
                ]
            }
        ];

        let currentMessage = null;
        const jumpBtn = document.getElementById('jumpBtn');
        const mario = document.getElementById('mario');
        const block = document.getElementById('block');
        const scoreDisplay = document.getElementById('score');
        let isJumping = false;
        let messageQueue = [];
        let currentMessageIndex = 0;

        // Inicializar cola de mensajes en el orden definido (1..N)
        function initializeMessageQueue() {
            // Copiamos el arreglo tal cual para preservar el orden
            messageQueue = [...messages];
            currentMessageIndex = 0;
        }

        // Obtener siguiente mensaje en orden (1..N) y reiniciar al terminar
        function getNextMessage() {
            if (currentMessageIndex >= messageQueue.length) {
                // Reiniciar el índice para volver a mostrar desde el principio
                currentMessageIndex = 0;
            }
            return messageQueue[currentMessageIndex++];
        }

        // Reusable AudioContext to prevent creating many contexts on repeated clicks
        let sharedAudioContext = null;
        function getAudioContext() {
            if (!sharedAudioContext) {
                sharedAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            // resume if it was suspended (some browsers require user gesture)
            if (sharedAudioContext.state === 'suspended') {
                sharedAudioContext.resume().catch(() => { });
            }
            return sharedAudioContext;
        }

        // Sonido de salto original de Mario Bros
        function createJumpSound() {
            const audioContext = getAudioContext();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'square';
            oscillator.frequency.setValueAtTime(1046, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1318, audioContext.currentTime + 0.08);

            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.12);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.12);
        }

        // Sonido de golpear bloque original de Mario Bros
        function createHitSound() {
            const audioContext = getAudioContext();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.type = 'square';
            const times = [0, 0.05, 0.1, 0.15];
            const freqs = [987, 1174, 1396, 1568];

            oscillator.frequency.setValueAtTime(freqs[0], audioContext.currentTime);
            for (let i = 1; i < times.length; i++) {
                oscillator.frequency.setValueAtTime(freqs[i], audioContext.currentTime + times[i]);
            }

            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.18);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.18);
        }

        // Inicializar cola de mensajes al cargar
        initializeMessageQueue();

        // Jump timing: centralized duration so JS and CSS stay consistent
        const jumpDuration = 800; // milliseconds (matches CSS animation 0.8s)

        jumpBtn.addEventListener('click', function () {
            if (isJumping) return;

            isJumping = true;
            mario.classList.add('jumping');

            // Reproducir sonido de salto solo una vez por clic
            createJumpSound();

            // Llamar a hitBlock alrededor del 50% del salto para mejor sincronía
            setTimeout(() => {
                hitBlock();
            }, Math.round(jumpDuration * 0.5));

            // Restaurar estado al terminar la animación
            setTimeout(() => {
                mario.classList.remove('jumping');
                isJumping = false;
            }, jumpDuration + 20);
        });

        function hitBlock() {
            block.classList.add('hit');

            // Reproducir sonido de golpe
            createHitSound();

            const nextMessage = getNextMessage();
            showMessage(nextMessage);

            setTimeout(() => {
                block.classList.remove('hit');
            }, 500);
        }

        function showMessage(messageData) {
            if (currentMessage) {
                currentMessage.remove();
            }

            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';

            // Build inner scrollable body
            const body = document.createElement('div');
            body.className = 'message-body';
            let contentHTML = '<h3>' + messageData.title + '</h3><ul>';
            messageData.content.forEach(item => {
                contentHTML += '<li>' + item + '</li>';
            });
            contentHTML += '</ul>';
            contentHTML += '<button class="close-btn" onclick="closeMessage()">✕</button>';
            body.innerHTML = contentHTML;
            messageDiv.appendChild(body);

            // Append and measure
            document.getElementById('gameContainer').appendChild(messageDiv);
            const modalRect = messageDiv.getBoundingClientRect();
            const logo = document.querySelector('.logo-container');
            const logoRect = logo ? logo.getBoundingClientRect() : null;

            // Start centered over logo or center screen
            let top = logoRect
                ? logoRect.top + (logoRect.height / 2) - (modalRect.height / 2)
                : Math.max(10, (window.innerHeight - modalRect.height) / 2);
            top = Math.max(10, Math.min(top, window.innerHeight - modalRect.height - 10));

            // Avoid overlapping jump button and block by shifting if needed
            const jumpRect = jumpBtn.getBoundingClientRect();
            const blockRect = block.getBoundingClientRect();

            function rectsOverlap(r1, r2) {
                return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
            }

            let attempts = 0;
            while (attempts < 6) {
                attempts++;
                const futureRect = { top: top, bottom: top + modalRect.height, left: modalRect.left, right: modalRect.right };
                if (rectsOverlap(futureRect, jumpRect) || rectsOverlap(futureRect, blockRect)) {
                    const move = Math.max(12, Math.round(window.innerHeight * 0.05));
                    if (top - move >= 10) {
                        top -= move;
                    } else if (top + move + modalRect.height <= window.innerHeight - 10) {
                        top += move;
                    } else {
                        break;
                    }
                } else {
                    break;
                }
            }

            messageDiv.style.top = top + 'px';
            currentMessage = messageDiv;
        }

        window.closeMessage = function () {
            if (currentMessage) {
                currentMessage.remove();
                currentMessage = null;
            }
        };
    </script>
</body>

</html>
